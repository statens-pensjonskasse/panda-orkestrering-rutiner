{
  "navn": "Månedskjøring for periode ${periode} med siste fremskrivingsdato ${fremskrivingsDato}",
  "metainfo": {
    "mal": "maler/fakturering/maanedlig_analyseunderlag_og_premiedifferanser.json",
    "tags": [
      "månedskjøring",
      "systemkorreksjon"
    ],
    "støttetAvPaOrkBa01FraVersjon": "1.0.11"
  },
  "gyldigVersjon": "1.0.11",
  "variabler": {
    "grunnlagsdataMappe": "#{grunnlagsdatamappeNå}",
    "grunnlagsdataFremskriving": "<grunnlagsdata_YYYY-MM-DD_HH-mm-ss>",

    "reserveberegningGrunnlagsdataAktuarVersjon": "<versjon>",
    "fremskrivingsDato": "<YYYY.MM.dd>",

    "forrigeFremskrivingsDato": "<YYYY.MM.dd>",

    "periode": "<periode>",
    "rettighet": "<rettighet>",
    "uttrekksdato": "<dd.MM.YYYY>",
    "skyopplasterId": "#{genererUUID}",

    "paResBa01Versjon": "<X.Y.Z>",
    "paFakBa03Versjon": "<X.Y.Z>",
    "paFakBa09Versjon": "<X.Y.Z>",
    "paFakBa11Versjon": "<X.Y.Z>"
  },
  "operasjoner": [
    {
      "handling": "deploy_batch",
      "batcher": [
        {
          "navn": "pa_res_ba_01",
          "versjon": "${paResBa01Versjon}"
        },
        {
          "navn": "pa_fak_ba_03",
          "versjon": "${paFakBa03Versjon}"
        },
        {
          "navn": "pa_fak_ba_09",
          "versjon": "${paFakBa09Versjon}"
        },
        {
          "navn": "pa_fak_ba_11",
          "versjon": "${paFakBa11Versjon}"
        }
      ]
    },
    {
      "navn": "pa_res_ba_01",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_res_ba_01"
        },
        {
          "handling": "kopier_arkivert_pa_res_ba_02_til_pa_res_ba_01",
          "fraGrunnlagsdataMappe": "${grunnlagsdataFremskriving}",
          "tilGrunnlagsdataMappe": "${grunnlagsdataFremskriving}"
        },
        {
          "handling": "kopier_arkivert_grunnlagsdata_fra_aktuar_til_pa_res_ba_01",
          "versjon": "${reserveberegningGrunnlagsdataAktuarVersjon}",
          "tilGrunnlagsdataMappe": "${grunnlagsdataFremskriving}"
        },
        {
          "navn": "panda_reserveberegning",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "pa_res_ba_01",
              "modus": "panda_reserveberegning",
              "sisteFremskrivingsdato": "${fremskrivingsDato}",
              "grunnlagsdataMappe": "${grunnlagsdataFremskriving}",
              "rettighet": "${rettighet}"
            },
            {
              "handling": "arkiver_all_batch_output",
              "batch": "pa_res_ba_01",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "nøkkel": "panda_reserveberegning/${fremskrivingsDato}/fremskriving_${paResBa01Versjon}"
            }
          ]
        },
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_res_ba_01"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_11 (flette_feilende_medlemmer)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_11"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "kontofoering",
          "batchFra": "pa_res_ba_01",
          "batchTil": "pa_fak_ba_11",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "panda_reserveberegning/${fremskrivingsDato}/fremskriving_${paResBa01Versjon}",
          "kommentar": "Henter fra siste grunnlagsdatamappe"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "feilmeldinger",
          "batchFra": "pa_res_ba_01",
          "batchTil": "pa_fak_ba_11",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "panda_reserveberegning/${fremskrivingsDato}/fremskriving_${paResBa01Versjon}",
          "kommentar": "Henter fra siste grunnlagsdatamappe"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchFra": "pa_fak_ba_11",
          "batchTil": "pa_fak_ba_11",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${forrigeFremskrivingsDato}",
          "kommentar": "Henter fra siste grunnlagsdatamappe"
        },
        {
          "handling": "hent_spesifisert_del_av_medlemsdata",
          "batchTil": "pa_fak_ba_11",
          "filnavnTil": "etterlatte",
          "typeindikator": "ETTERLATT",
          "grunnlagsdataMappeFra": "${grunnlagsdataFremskriving}",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}"
        },
        {
          "handling": "pa_fak_ba_11",
          "modus": "flette_feilende_medlemmer",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "reserveberegningVersjon": "${paResBa01Versjon}",
          "validerFeilendeMedlemmer": true
        },
        {
          "handling": "arkiver_all_batch_output",
          "batch": "pa_fak_ba_11",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${fremskrivingsDato}/fremskriving_${paResBa01Versjon}"
        },
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_11"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_03 (reserveoppbygging)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_03"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchFra": "pa_fak_ba_11",
          "batchTil": "pa_fak_ba_03",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${forrigeFremskrivingsDato}/fremskriving_${paResBa01Versjon}",
          "kommentar": "Henter fra siste grunnlagsdatamappe"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchFra": "pa_fak_ba_11",
          "batchTil": "pa_fak_ba_03",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${fremskrivingsDato}/fremskriving_${paResBa01Versjon}",
          "kommentar": "Henter fra siste grunnlagsdatamappe"
        },
        {
          "handling": "pa_fak_ba_03",
          "modus": "reserveoppbygging",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "førsteKjøring": "${forrigeFremskrivingsDato}",
          "andreKjøring": "${fremskrivingsDato}",
          "bokføringsperiode": "${periode}",
          "validerFeilendeMedlemmer": true
        },
        {
          "handling": "arkiver_all_batch_output",
          "batch": "pa_fak_ba_03",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "reserveoppbygging/${periode}/fremskriving_${paResBa01Versjon}"
        },
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_03"
        }
      ]
    },
    {
      "navn": "Underlag til DVH",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "navn": "pa_fak_ba_09 (reserveoppbygging)",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "rydd_grunnlagsdata_for_batch",
              "batch": "pa_fak_ba_09"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "reserveoppbygging",
              "batchFra": "pa_fak_ba_03",
              "batchTil": "pa_fak_ba_09",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "reserveoppbygging/${periode}/fremskriving_${paResBa01Versjon}"
            },
            {
              "handling": "pa_fak_ba_09",
              "modus": "generer_reserveoppbygging_dataunderlag",
              "kjøringsId": "#{genererUUID}",
              "uttrekksdato": "${uttrekksdato}",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "validerFeilendeMedlemmer": true
            },
            {
              "handling": "arkiver_all_batch_output",
              "batch": "pa_fak_ba_09",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "nøkkel": "generer_reserveoppbygging_dataunderlag/${periode}/fremskriving_${paResBa01Versjon}"
            },
            {
              "handling": "send_batch_output_til_dvh",
              "filPrefix": "reserveoppbygging_dataunderlag",
              "filListe": "RESERVEOPPBYGGING_FILLISTE.txt",
              "batch": "pa_fak_ba_09",
              "filstiHosDVH": "/reserveoppbygging"
            },
            {
              "handling": "kopier_filer_fra_arkiv_til_skyopplaster",
              "fraBatch": "pa_fak_ba_09",
              "filPrefix": "reserveoppbygging_dataunderlag",
              "nøkkel": "generer_reserveoppbygging_dataunderlag/${periode}/fremskriving_${paResBa01Versjon}",
              "kjøringsId": "reserveoppbygging-${skyopplasterId}",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}"
            },
            {
              "handling": "opprett_bestilling_til_skyopplaster",
              "kjøringsId": "reserveoppbygging-${skyopplasterId}",
              "filstiHosDVH": "reserveoppbygging"
            }
          ]
        }
      ]
    }
  ]
}