{
  "navn": "Helsesjekk for månedskjøring med siste fremskrivingsdato ${fremskrivingsDato}, reserveberegning med versjon ${paResBa01Versjon} og grunnlagsdata ${grunnlagsdataFremskriving}",
  "metainfo": {
    "mal": "maler/fakturering/helsesjekk_maanedlig_analyseunderlag_og_premiedifferanser.json",
    "tags": [
      "eksport"
    ],
    "støttetAvPaOrkBa01FraVersjon": "1.4.7"
  },
  "gyldigVersjon": "1.0.11",
  "variabler": {
    "grunnlagsdataMappe": "#{grunnlagsdatamappeNå}",
    "grunnlagsdataFremskriving": "<grunnlagsdata_YYYY-MM-DD_HH-mm-ss>",
    "reserveberegningGrunnlagsdataAktuarVersjon": "<versjon>",
    "fremskrivingsDato": "<YYYY.MM.dd>",
    "forrigeFremskrivingsDato": "<YYYY.MM.dd>",
    "periode": "<periode>",
    "rettighet": "<rettighet>",

    "paResBa01Versjon": "<X.Y.Z>",
    "paFakBa02Versjon": "<X.Y.Z>",
    "paFakBa03Versjon": "<X.Y.Z>",
    "paFakBa11Versjon": "<X.Y.Z>",
    "paFakBa12Versjon": "<X.Y.Z>",
    "paFakBa13Versjon": "<X.Y.Z>",
    "paOrkBa05Versjon": "<X.Y.Z>"
  },
  "operasjoner": [
    {
      "handling": "rydd_mellomlager"
    },
    {
      "handling": "deploy_batch",
      "batcher": [
        {
          "navn": "pa_res_ba_01",
          "versjon": "${paResBa01Versjon}"
        },
        {
          "navn": "pa_fak_ba_02",
          "versjon": "${paFakBa02Versjon}"
        },
        {
          "navn": "pa_fak_ba_03",
          "versjon": "${paFakBa03Versjon}"
        },
        {
          "navn": "pa_fak_ba_11",
          "versjon": "${paFakBa11Versjon}"
        },
        {
          "navn": "pa_fak_ba_12",
          "versjon": "${paFakBa12Versjon}"
        },
        {
          "navn": "pa_fak_ba_13",
          "versjon": "${paFakBa13Versjon}"
        },
        {
          "navn": "pa_ork_ba_05",
          "versjon": "${paOrkBa05Versjon}"
        }
      ]
    },
    {
      "navn": "pa_res_ba_01",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_res_ba_01"
        },
        {
          "handling": "kopier_arkivert_pa_res_ba_02_til_pa_res_ba_01",
          "fraGrunnlagsdataMappe": "${grunnlagsdataFremskriving}",
          "tilGrunnlagsdataMappe": "${grunnlagsdataFremskriving}"
        },
        {
          "handling": "kopier_arkivert_grunnlagsdata_fra_aktuar_til_pa_res_ba_01",
          "versjon": "${reserveberegningGrunnlagsdataAktuarVersjon}",
          "tilGrunnlagsdataMappe": "${grunnlagsdataFremskriving}"
        },
        {
          "navn": "panda_reserveberegning",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "pa_res_ba_01",
              "modus": "panda_reserveberegning",
              "sisteFremskrivingsdato": "${fremskrivingsDato}",
              "grunnlagsdataMappe": "${grunnlagsdataFremskriving}",
              "rettighet": "${rettighet}"
            },
            {
              "handling": "mellomlagre_all_batch_output",
              "batch": "pa_res_ba_01",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "nøkkel": "panda_reserveberegning/${fremskrivingsDato}"
            },
            {
              "navn": "Rapporter feilmeldinger",
              "handling": "gruppe",
              "gruppeAv": [
                {
                  "handling": "rydd_grunnlagsdata_for_batch",
                  "batch": "pa_fak_ba_12"
                },
                {
                  "handling": "kopier_fra_mellomlager_til_batch",
                  "filnavn": "feilmeldinger",
                  "batchTil": "pa_fak_ba_12",
                  "grunnlagsdataMappeFra": "${grunnlagsdataMappe}",
                  "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
                  "nøkkel": "panda_reserveberegning/${fremskrivingsDato}",
                  "feilHvisFilMangler": true
                },
                {
                  "handling": "pa_fak_ba_12",
                  "grunnlagsdataMappe": "${grunnlagsdataMappe}",
                  "modus": "aggreger_csv",
                  "filnavn": "feilmelding",
                  "utFilnavn": "feilmeldinger_aggregert",
                  "grupperingsfelter": 3,
                  "skalTelleAntallGruppert": true
                },
                {
                  "handling": "rydd_grunnlagsdata_for_batch",
                  "batch": "pa_ork_ba_05"
                },
                {
                  "handling": "kopier_filer_fra_batch_til_batch",
                  "filPrefix": "feilmeldinger_aggregert",
                  "fraBatch": "pa_fak_ba_12",
                  "tilBatch": "pa_ork_ba_05",
                  "kopierFraTidsserieKatalog": false
                },
                {
                  "handling": "pa_ork_ba_05",
                  "program": "aggregerte_feilmeldinger",
                  "kilde": "pa_res_ba_01_snapshot",
                  "sisteFremskrivingsdato": "${fremskrivingsDato}"
                }
              ]
            }
          ]
        },
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_res_ba_01"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_11 (flette_feilende_medlemmer)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_11"
        },
        {
          "handling": "kopier_fra_mellomlager_til_batch",
          "filnavn": "kontofoering",
          "batchTil": "pa_fak_ba_11",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "panda_reserveberegning/${fremskrivingsDato}"
        },
        {
          "handling": "kopier_fra_mellomlager_til_batch",
          "filnavn": "feilmeldinger",
          "batchTil": "pa_fak_ba_11",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "panda_reserveberegning/${fremskrivingsDato}"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchFra": "pa_fak_ba_11",
          "batchTil": "pa_fak_ba_11",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${forrigeFremskrivingsDato}",
          "kommentar": "Henter fra siste grunnlagsdatamappe"
        },
        {
          "handling": "hent_spesifisert_del_av_medlemsdata",
          "batchTil": "pa_fak_ba_11",
          "filnavnTil": "etterlatte",
          "typeindikator": "ETTERLATT",
          "grunnlagsdataMappeFra": "${grunnlagsdataFremskriving}",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}"
        },
        {
          "handling": "pa_fak_ba_11",
          "modus": "flette_feilende_medlemmer",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "reserveberegningVersjon": "${paResBa01Versjon}",
          "flettetFremskrivingsdato": "${fremskrivingsDato}",
          "validerFeilendeMedlemmer": true
        },
        {
          "handling": "mellomlagre_all_batch_output",
          "batch": "pa_fak_ba_11",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${fremskrivingsDato}"
        },
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_11"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_03 (reserveoppbygging)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_03"
        },
        {
          "handling": "kopier_fra_arkiv_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchFra": "pa_fak_ba_11",
          "batchTil": "pa_fak_ba_03",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${forrigeFremskrivingsDato}"
        },
        {
          "handling": "kopier_fra_mellomlager_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchTil": "pa_fak_ba_03",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${fremskrivingsDato}"
        },
        {
          "handling": "pa_fak_ba_03",
          "modus": "reserveoppbygging",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "førsteKjøring": "${forrigeFremskrivingsDato}",
          "andreKjøring": "${fremskrivingsDato}",
          "bokføringsperiode": "${periode}",
          "validerFeilendeMedlemmer": true
        },
        {
          "handling": "mellomlagre_all_batch_output",
          "batch": "pa_fak_ba_03",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "reserveoppbygging/${periode}"
        },
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_03"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_13 (generer_fakturerbare_premiedifferanser)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_13"
        },
        {
          "handling": "kopier_fra_mellomlager_til_batch",
          "filnavn": "reserveoppbygging",
          "batchTil": "pa_fak_ba_13",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "reserveoppbygging/${periode}"
        },
        {
          "handling": "pa_fak_ba_13",
          "modus": "generer_fakturerbare_premiedifferanser",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "validerFeilendeMedlemmer": true
        },
        {
          "handling": "mellomlagre_all_batch_output",
          "batch": "pa_fak_ba_13",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "generer_fakturerbare_premiedifferanser/${periode}"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_02 (reserveaggregering_for_medlem)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_02"
        },
        {
          "handling": "kopier_fra_mellomlager_til_batch",
          "filnavn": "flettede_kontofoeringer",
          "batchTil": "pa_fak_ba_02",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "flette_feilende_medlemmer/${fremskrivingsDato}"
        },
        {
          "handling": "pa_fak_ba_02",
          "modus": "reserveaggregering_for_medlem",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "validerFeilendeMedlemmer": true
        },
        {
          "handling": "mellomlagre_all_batch_output",
          "batch": "pa_fak_ba_02",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "reserveaggregering_for_medlem/${fremskrivingsDato}"
        }
      ]
    },
    {
      "navn": "pa_fak_ba_12 (aggreger totalreserve)",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "rydd_grunnlagsdata_for_batch",
          "batch": "pa_fak_ba_12"
        },
        {
          "handling": "kopier_fra_mellomlager_til_batch",
          "filnavn": "totalreserver",
          "batchTil": "pa_fak_ba_12",
          "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
          "nøkkel": "reserveaggregering_for_medlem/${fremskrivingsDato}"
        },
        {
          "handling": "pa_fak_ba_12",
          "modus": "aggreger_csv",
          "filnavn": "totalreserver",
          "utFilnavn": "totalreserve",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "resultatfelter": "5"
        },
        {
          "handling": "mellomlagre_all_batch_output",
          "batch": "pa_fak_ba_12",
          "grunnlagsdataMappe": "${grunnlagsdataMappe}",
          "nøkkel": "pa_fak_ba_02/reserveaggregering_for_medlem/${fremskrivingsDato}"
        }
      ]
    },
    {
      "handling": "rydd_mellomlager"
    }
  ]
}