{
  "navn": "Systemkorreksjons som sammenlikner eksisterende versjon av panda ${første_versjon_reserveberegning} mot ny kjøring av panda med versjon ${andre_versjon_reserveberegning}, begge på samme fremskrivingsdato ${fremskrivingsDato}",
  "metainfo": {
    "mal": "maler/fakturering/systemkorreksjon.json",
    "tags": ["systemkorreksjon"],
    "støttetAvPaOrkBa01FraVersjon": "0.0.60"
  },
  "gyldigVersjon": "0.0.60",
  "variabler": {
    "grunnlagsdataMappe": "#{grunnlagsdatamappeNå}",
    "skyopplasterId": "#{genererUUID}",

    "grunnlagsdataFremskriving": "<grunnlagsdata_YYYY-MM-DD_HH-mm-ss>",
    "reserveberegningGrunnlagsdataAktuarVersjon": "<versjon>",

    "fremskrivingsDato": "<YYYY.MM.dd>",
    "forrigeFremskrivingsDato": "<YYYY.MM.dd>",

    "bokføringsperiode": "<bokføringsperiode>",
    "uttrekksdato": "<dd.MM.YYYY>",

    "første_versjon_reserveberegning": "<X.Y.Z>",
    "andre_versjon_reserveberegning": "<X.Y.Z>",

    "paFakBa03Versjon": "<X.Y.Z>",
    "paFakBa09Versjon": "<X.Y.Z>",
    "paFakBa11Versjon": "<X.Y.Z>"
  },
  "operasjoner": [
    {
      "handling": "deploy_batch",
      "batcher": [
        {
          "navn": "pa_fak_ba_03",
          "versjon": "${paFakBa03Versjon}"
        },
        {
          "navn": "pa_fak_ba_09",
          "versjon": "${paFakBa09Versjon}"
        },
        {
          "navn": "pa_fak_ba_11",
          "versjon": "${paFakBa11Versjon}"
        }
      ]
    },
    {
      "navn": "Kjøring av systemkorreksjon",
      "handling": "gruppe",
      "gruppeAv": [
        {
          "handling": "deploy_batch",
          "batcher": [
            {
              "navn": "pa_res_ba_01",
              "versjon": "${andre_versjon_reserveberegning}"
            }
          ]
        },
        {
          "navn": "pa_res_ba_01 (panda_reserveberegning)",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "rydd_grunnlagsdata_for_batch",
              "batch": "pa_res_ba_01",
              "grunnlagsdataMappe": "${grunnlagsdataFremskriving}"
            },
            {
              "handling": "kopier_arkivert_pa_res_ba_02_til_pa_res_ba_01",
              "fraGrunnlagsdataMappe": "${grunnlagsdataFremskriving}",
              "tilGrunnlagsdataMappe": "${grunnlagsdataFremskriving}"
            },
            {
              "handling": "kopier_arkivert_grunnlagsdata_fra_aktuar_til_pa_res_ba_01",
              "versjon": "${reserveberegningGrunnlagsdataAktuarVersjon}",
              "tilGrunnlagsdataMappe": "${grunnlagsdataFremskriving}"
            },
            {
              "handling": "pa_res_ba_01",
              "modus": "panda_reserveberegning",
              "sisteFremskrivingsdato": "${fremskrivingsDato}",
              "grunnlagsdataMappe": "${grunnlagsdataFremskriving}",
              "rettighet": "panda_veldig_forenkla_rettighet"
            },
            {
              "handling": "arkiver_all_batch_output",
              "batch": "pa_res_ba_01",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/panda_reserveberegning/${fremskrivingsDato}/${andre_versjon_reserveberegning}"
            }
          ]
        },
        {
          "navn": "pa_fak_ba_11 (flettede_kontofoeringer)",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "rydd_grunnlagsdata_for_batch",
              "batch": "pa_fak_ba_11",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "kontofoering",
              "batchFra": "pa_res_ba_01",
              "batchTil": "pa_fak_ba_11",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/panda_reserveberegning/${fremskrivingsDato}/${andre_versjon_reserveberegning}"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "feilmeldinger",
              "batchFra": "pa_res_ba_01",
              "batchTil": "pa_fak_ba_11",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/panda_reserveberegning/${fremskrivingsDato}/${andre_versjon_reserveberegning}"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "flettede_kontofoeringer",
              "batchFra": "pa_fak_ba_11",
              "batchTil": "pa_fak_ba_11",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "flette_feilende_medlemmer/${forrigeFremskrivingsDato}",
              "kommentar": "Henter fra fakturering"
            },
            {
              "handling": "hent_spesifisert_del_av_medlemsdata",
              "batchTil": "pa_fak_ba_11",
              "filnavnTil": "etterlatte",
              "typeindikator": "ETTERLATT",
              "grunnlagsdataMappeFra": "${grunnlagsdataFremskriving}",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}"
            },
            {
              "handling": "pa_fak_ba_11",
              "modus": "flette_feilende_medlemmer",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "reserveberegningVersjon": "${andre_versjon_reserveberegning}",
              "validerFeilendeMedlemmer": true
            },
            {
              "handling": "arkiver_all_batch_output",
              "batch": "pa_fak_ba_11",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/flette_feilende_medlemmer/${fremskrivingsDato}/${andre_versjon_reserveberegning}"
            },
            {
              "handling": "rydd_grunnlagsdata_for_batch",
              "batch": "pa_fak_ba_11",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}"
            }
          ]
        },
        {
          "navn": "pa_fak_ba_03 (systemkorreksjon)",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "rydd_grunnlagsdata_for_batch",
              "batch": "pa_fak_ba_03",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "flettede_kontofoeringer",
              "batchFra": "pa_fak_ba_11",
              "batchTil": "pa_fak_ba_03",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "flette_feilende_medlemmer/${fremskrivingsDato}"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "flettede_kontofoeringer",
              "batchFra": "pa_fak_ba_11",
              "batchTil": "pa_fak_ba_03",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/flette_feilende_medlemmer/${fremskrivingsDato}/${andre_versjon_reserveberegning}"
            },
            {
              "handling": "pa_fak_ba_03",
              "modus": "systemkorreksjon",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "bokføringsperiode": "${bokføringsperiode}",
              "fraReserveberegningVersjon": "${første_versjon_reserveberegning}",
              "tilReserveberegningVersjon": "${andre_versjon_reserveberegning}",
              "validerFeilendeMedlemmer": true,
              "feilHvisFilMangler": false
            },
            {
              "handling": "arkiver_all_batch_output",
              "batch": "pa_fak_ba_03",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/${første_versjon_reserveberegning}-${andre_versjon_reserveberegning}"
            }
          ]
        },
        {
          "navn": "pa_fak_ba_09 (generer_systemkorreksjon_dataunderlag)",
          "handling": "gruppe",
          "gruppeAv": [
            {
              "handling": "rydd_grunnlagsdata_for_batch",
              "batch": "pa_fak_ba_09",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}"
            },
            {
              "handling": "kopier_fra_arkiv_til_batch",
              "filnavn": "systemkorreksjon",
              "batchFra": "pa_fak_ba_03",
              "batchTil": "pa_fak_ba_09",
              "grunnlagsdataMappeTil": "${grunnlagsdataMappe}",
              "nøkkel": "systemkorreksjon/${første_versjon_reserveberegning}-${andre_versjon_reserveberegning}"
            },
            {
              "handling": "pa_fak_ba_09",
              "modus": "generer_systemkorreksjon_dataunderlag",
              "grunnlagsdataMappe": "${grunnlagsdataMappe}",
              "kjøringsId": "#{genererUUID}",
              "uttrekksdato": "${uttrekksdato}",
              "validerFeilendeMedlemmer": true
            },
            {
              "handling": "kopier_filer_fra_batch_til_skyopplaster",
              "fraBatch": "pa_fak_ba_09",
              "filPrefix": "systemkorreksjon_dataunderlag",
              "kjøringsId": "generer_systemkorreksjon_dataunderlag-${skyopplasterId}"
            },
            {
              "handling": "opprett_bestilling_til_skyopplaster",
              "kjøringsId": "generer_systemkorreksjon_dataunderlag-${skyopplasterId}",
              "filstiHosDVH": "systemkorreksjon"
            }
          ]
        }
      ]
    }
  ]
}
